<!-- <!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <title>CryptoZombies front-end</title>
<link rel="icon" href="favicon.ico">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script language="javascript" type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
  <script language="javascript" type="text/javascript" src="cryptozombies_abi.js"></script>
</head>

<body>
  <div id="txStatus"></div>
  <div id="zombies"></div>
  <div class="container" >
    <div class=" row">
      <div class="col-sm-8">
    <img src="./images/cryptoZombies.png"> 


      </div>
      <div class="col-sm-4" style="display:flex; flex-direction: column; "  >
       

    <button class="showZombieButton btn btn-success "  style="margin-top: 150px;padding:12px; ">Show Zombies</button>
    <button class="createzombieButton btn btn-primary "  style="margin-top: 20px;padding:12px; ">Create Zombie</button>
    <button class="levelupButton btn btn-warning"  style="margin-top: 20px;padding:12px; "  >Level Up</button> 
    <br>
    <input class="targetId " placeholder="Enter Enemy Zombie Address"/>
    <button class="attack btn btn-danger" style="margin-top: 20px;padding:12px; ">Attack</button>
    <br>
    <input class="changeName" placeholder="Enter New Name"/>
    <button class="changeNameBtn btn btn-primary" style="margin-top: 20px;padding:12px; ">Change Name</button>
    <br>
    <input class="changeDna" placeholder="Enter New Dna (size = 16 characters)"/>
    <button class="changeDnaBtn btn btn-primary" style="margin-top: 20px;padding:12px; ">Change Dna</button>
    <img src="./images/crypto.gif" style="margin-top: 130px;"> 

    </div>
         </div>
      </div>
    </div>
    


  
   
  </div>



  <script>

    var cryptoZombies;
    var userAccount;
    const showZombieButton = document.querySelector('.showZombieButton');
    const createzombieButton = document.querySelector('.createzombieButton');
    const levelupButton = document.querySelector('.levelupButton');
    const targetid = document.querySelector('.targetId');
    const attack = document.querySelector('.attack');
    const cname = document.querySelector('.changeName');
    const cnameBtn = document.querySelector('.changeNameBtn');
    const cdna = document.querySelector('.changeDna');
    const cdnaBtn = document.querySelector('.changeDnaBtn');

    function startApp() {
	
      //ZombieOwnership contratc address
      // var cryptoZombiesAddress = "0xC08d276D3022F1E9E1e99eBAa6410fE4FcbEcB8f";
      var cryptoZombiesAddress = "0x86Fe06c36321E78DA51035AE9f4c4B45cFEF46a8";

      cryptoZombies = new web3.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);

 //the following code from Lesson 6, chapter 5 is obsolete
 //     var accountInterval = setInterval(function () {

  //      if (web3.eth.accounts[0] !== userAccount) {
          //userAccount = web3.eth.accounts[0];

     //     getZombiesByOwner(userAccount)
      //      .then(displayZombies);
      //  }
     // }, 100);

      cryptoZombies.events.Transfer({ filter: { _to: userAccount } })
        .on("data", function (event) {
          let data = event.returnValues;
          getZombiesByOwner(userAccount).then(displayZombies);
        }).on("error", console.error);
    }

    function displayZombies(ids) {
      $("#zombies").empty();
      console.log(ids);
      for (id of ids) {

        getZombieDetails(id)
          .then(function (zombie) {


            $("#zombies").append(`<div class="zombie" style="border-style: solid; background: linear-gradient(45deg, black,  #63645E );color:white;">
              <div class='row'>
                <div class='col-sm-1'></div>

              <div class='col-sm-4'>
             <img src="./images/zombie.png" style="width:150px; height:230px; margin-top:20px; margin-left:130px"> 
             <li style="margin-top:10px; margin-bottom:18px; list-style-type:none; text-align:center">Name: ${zombie.name}</li>

             </div>
             <div class='col-sm-7'>
              
              <ul style=" list-style-type:none; margin-top:20px">
                <li>DNA: ${zombie.dna}</li>
                <li>Level: ${zombie.level}</li>
                <li>Wins: ${zombie.winCount}</li>
                <li>Losses: ${zombie.lossCount}</li>
                <li>Ready Time: ${zombie.readyTime}</li>
              </ul>
             </div>

              </div>
            </div>`);
          });
      }

    }

    function createRandomZombie(name) {


      $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"}).text("Creating new zombie on the blockchain. This may take a while...");

      return cryptoZombies.methods.createRandomZombie(name)
        .send({ from: userAccount })
        .on("receipt", function (receipt) {
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"}).text("Successfully created " + name + "!");
          
          getZombiesByOwner(userAccount).then(displayZombies);
        })
        .on("error", function (error) {

          $("#txStatus").text(error);
        });
    }

    function feedOnKitty(zombieId, kittyId) {
      $("#txStatus").text("Eating a kitty. This may take a while...");
      return cryptoZombies.methods.feedOnKitty(zombieId, kittyId)
        .send({ from: userAccount })
        .on("receipt", function (receipt) {
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"}).text("Ate a kitty and spawned a new Zombie!");
          getZombiesByOwner(userAccount).then(displayZombies);
        })
        .on("error", function (error) {
          $("#txStatus").text(error);
        });
    }

    function attackZombie(zombieId) {
      console.log(zombieId);
      getZombiesByOwner(targetid.value)
        .then(function(enemyId) {
          console.log(enemyId);
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
          .text("Attacking " + targetid.value + " zombie!");
          return cryptoZombies.methods.attack(zombieId, enemyId)
            .send({ from: userAccount })
            .on("receipt", function (receipt) {
              $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
              .text("Attack Complete !");
            })
            .on("error", function (error) {
              $("#txStatus").text(error);
            });
        });
    }

    function fchangename(zombieId) {
          console.log(cname.value);
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
          .text("Name Changing to " + cname.value );
          return cryptoZombies.methods.changeName(zombieId, cname.value)
            .send({ from: userAccount })
            .on("receipt", function (receipt) {
              $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
              .text("Change Complete !");
            })
            .on("error", function (error) {
              $("#txStatus").text(error);
            });
    }

    function fchangedna(zombieId) {
          console.log(cdna.value);
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
          .text("Dna Changing to " + cdna.value );
          return cryptoZombies.methods.changeDna(zombieId, cdna.value)
            .send({ from: userAccount })
            .on("receipt", function (receipt) {
              $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
              .text("Change Complete !");
            })
            .on("error", function (error) {
              $("#txStatus").text(error);
            });
    }

    function levelUp(zombieId) {
      $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"}).text("Leveling up your zombie...");
      return cryptoZombies.methods.levelUp(zombieId)
        .send({ from: userAccount, value: web3.utils.toWei("0.001", "ether") })
        .on("receipt", function (receipt) {
          $("#txStatus").css({"font-weight":"bold","text-align":"center", "margin-top":"30px"})
          .text("Power overwhelming! Zombie successfully leveled up");

          // $("#txStatus").text("Power overwhelming! Zombie successfully leveled up");
        })
        .on("error", function (error) {
          $("#txStatus").text(error);
        });
    }

    function getZombieDetails(id) {
      return cryptoZombies.methods.zombies(id).call()
    }

    function zombieToOwner(id) {
      return cryptoZombies.methods.zombieToOwner(id).call()
    }

    function getZombiesByOwner(owner) {
      return cryptoZombies.methods.getZombiesByOwner(owner).call()
    }

    window.addEventListener('load', async () => {
    // Modern dapp browsers...
    if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
            // Request account access if needed
            const accounts = await ethereum.enable();
            // Acccounts now exposed
            userAccount = accounts[0];
            startApp()
        } catch (error) {
            // User denied account access...
        }
    }
    // Legacy dapp browsers...
    else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
        // Acccounts always exposed
        userAccount = web3.eth.accounts[0];
        startApp()
    }
    // Non-dapp browsers...
    else {
        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
    }
   });
 
   //the following code from Lesson 6, chapter 2 is obsolete
   //metamask no longer inject web3 since early 2021
   //window.addEventListener('load', function () {

  //    if (typeof web3 !== 'undefined') {
   //     web3js = new Web3(web3.currentProvider);
   //   } else {

    //  }


    //  startApp()

  //  }) 

   ethereum.on('accountsChanged', (accounts) => {
       window.location.reload();
   });

   ethereum.on('chainChanged', (chainId) => {
       window.location.reload(); 
   });  

 
    createzombieButton.addEventListener('click', () => {
      createRandomZombie(userAccount);
      console.log(userAccount);
    });

    showZombieButton.addEventListener('click', () => {
      getZombiesByOwner(userAccount)
            .then(displayZombies);

    });

    levelupButton.addEventListener('click', () => {
      getZombiesByOwner(userAccount)
            .then(levelUp);

    });

    attack.addEventListener('click', () => {
      // var myId = getZombiesByOwner(userAccount);
      // var enemyId = getZombiesByOwner(targetid.value);
      getZombiesByOwner(userAccount)
        .then(attackZombie);
    })

    cnameBtn.addEventListener('click', () => {
      // var myId = getZombiesByOwner(userAccount);
      // var enemyId = getZombiesByOwner(targetid.value);
      getZombiesByOwner(userAccount)
        .then(fchangename);
    })

    cdnaBtn.addEventListener('click', () => {
      // var myId = getZombiesByOwner(userAccount);
      // var enemyId = getZombiesByOwner(targetid.value);
      let dna = cdna.value;
      let length = dna.length;
      console.log(dna + " " + length);
      if(length < 16 || length > 16) {
        
      } else {
        getZombiesByOwner(userAccount)
          .then(fchangedna);
      }
    })

  </script>
</body>

</html> -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
    <script src="myShip.js"></script>
    <script src="shot.js"></script>
    <script src="alien.js"></script>
    <script src="laser.js"></script>
    <script src="redAlien.js"></script>

   <script src="sketch.js"></script> 

    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />

  </head>
  <body>

  
    <nav class="nav nav-pills flex-column flex-sm-row"style="background-image: linear-gradient(to right, #04619F, #000000 );  ">
      <a class="flex-sm-fill text-sm-center nav-link"style="color: white;" href='javascript:sketch.js'>   Home</a>
    <a class="flex-sm-fill text-sm-center nav-link" style="color: white;"  href="#">NFT MarketPlace</a>
    <a class="flex-sm-fill text-sm-center nav-link" style="color: white;"  href="auction.html">Auction</a>

    <!-- <a class="flex-sm-fill text-sm-center nav-link" style="color: white;"  href="marketPlace.html">NFT MarketPlace</a> -->
 </nav> 
    <!-- <script src="sketch.js"></script> -->

  </body>
</html>
